<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom styles... */
        .planner-box {
            background-color: #f06292; /* Light pink */
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .planner-box h4 {
            color: white;
            text-align: center;
            text-transform: uppercase;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .form-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .form-container h4 {
            color: #ec407a; /* Light pink */
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group label {
            font-weight: bold;
            color: #ec407a; /* Light pink */
        }

        .form-group textarea {
            resize: none;
        }

        .btn-primary {
            background-color: #f06292; /* Light pink */
            border-color: #f06292; /* Light pink */
        }

        .btn-primary:hover {
            background-color: #e91e63; /* Pink */
            border-color: #e91e63; /* Pink */
        }

        .btn-danger {
            background-color: #ffb6c1; /* Light pink */
            border-color: #ffb6c1; /* Light pink */
        }

        .btn-danger:hover {
            background-color: #ff9ca8; /* Darker light pink */
            border-color: #ff9ca8; /* Darker light pink */
        }

        .table th, .table td {
            vertical-align: middle;
            color: #616161; /* Dark grey */
            text-align: center; /* Center align text in table cells */
        }

        .table th {
            background-color: #f06292; /* Light pink */
            color: white;
        }

        .btn-generate {
            background-color: #f06292; /* Light pink */
            border-color: #f06292; /* Light pink */
            color: white;
        }

        .btn-generate:hover {
            background-color: #e91e63; /* Pink */
            border-color: #e91e63; /* Pink */
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="planner-box">
                    <h4>Planner</h4>
                </div>
                <div class="form-container">
                    <form id="addMinuteForm" class="card p-4">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="day">Date</label>
                            <input type="text" id="day" name="day" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="name">MeetingID</label>
                            <input type="text" id="name" name="name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Meeting Minute</label>
                            <textarea id="description" name="description" class="form-control" rows="5"></textarea>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="addMinute()">Add Minute</button>
                    </form>
                    <hr>
                    <table class="table mt-4">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Date</th>
                                <th scope="col">MeetingID</th>
                                <th scope="col">Meeting Minute</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="plannerTableBody">
                            {% for planner in planners %}
                            <tr>
                                <th scope="row">{{ forloop.counter }}</th>
                                <td>{{ planner.day }}</td>
                                <td>{{ planner.name }}</td>
                                <td>{{ planner.description }}</td>
                                <td class="text-right"> <!-- Align buttons to the right -->
                                    <button class="btn btn-danger" onclick="confirmDelete({{ planner.id }})">Delete</button>
                                    <a href="/update_planner/{{ planner.id }}" class="btn btn-primary">Update</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function addMinute() {
            var day = document.getElementById('day').value;
            var name = document.getElementById('name').value;
            var description = document.getElementById('description').value;

            if (day.trim() === '' || name.trim() === '' || description.trim() === '') {
                alert('Please fill in all fields.');
                return;
            }

            var formData = new FormData();
            formData.append('day', day);
            formData.append('name', name);
            formData.append('description', description);

            fetch('{% url 'planner' %}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Minute added successfully.');
                    document.getElementById('day').value = '';
                    document.getElementById('name').value = '';
                    document.getElementById('description').value = '';

                    // Calculate the new row number
                    var newRowNumber = document.querySelectorAll('#plannerTableBody tr').length + 1;

                    // Construct the new row HTML
                    var newRow = `<tr>
                                    <th scope="row">${newRowNumber}</th>
                                    <td>${day}</td>
                                    <td>${name}</td>
                                    <td>${description}</td>
                                    <td class="text-right">
                                        <button class="btn btn-danger" onclick="confirmDelete(${data.id})">Delete</button>
                                        <a href="/update_planner/${data.id}" class="btn btn-primary">Update</a>
                                    </td>
                                </tr>`;

                    // Insert new row at the beginning of the table
                    var tableBody = document.getElementById('plannerTableBody');
                    tableBody.insertAdjacentHTML('beforeend', newRow);
                } else {
                    alert('Failed to add minute.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while adding minute.');
            });
        }

        function confirmDelete(id) {
            if (confirm('Are you sure you want to delete this minute?')) {
                fetch(`/delete_planner/${id}`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Minute deleted successfully.');
                        // Remove deleted row from table
                        var rowToRemove = document.querySelector(`#plannerTableBody tr[data-id="${id}"]`);
                        if (rowToRemove) {
                            rowToRemove.remove();

                            // Update row numbers after deletion
                            var rows = document.querySelectorAll('#plannerTableBody tr');
                            rows.forEach((row, index) => {
                                row.querySelector('th').textContent = index + 1;
                            });
                        }
                    } else {
                        alert('Failed to delete minute.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting minute.');
                });
            }
        }
    </script>
</body>
</html>
